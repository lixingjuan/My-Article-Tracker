# 输入 URL 发生了什么

## 1. 强缓存判断

当用户请求一个网页或者资源时，浏览器会首先检查本地**是否有该请求的缓存副本**，并检查这些缓存**是否仍然有效**（通过 cache-control 和 Expires 字段）。

**cache-control** 字段，HTTP1.1 引入字段，提供了资源可以被缓存的细节

1. max-age=[seconds], 表示缓存可以在本地缓存并被重复使用多长时间（秒为单位）。从资源被请求的那一刻算起
2. no-cache: 意味着缓存被用重用前，必须向服务器验证有效性
3. no-store: 表示任何端均不能进行缓存
4. public/private: public 表示响应可以被任何缓存存储；private, 表示响应只能被用户浏览器进行存储

**Expires 字段**, HTTP1.0 引入的字段

1. 他提供了一个时间点，告诉浏览器，缓存在该时间点之前可以直接从缓存中提取资源无需向服务器请求，在此之后的时间被认为是过期的

**检查缓存过程**
cache-control 和 Expires, 任一条件满足，缓存均为认为有效，可以直接使用

**表现**：如果缓存有效，则直接从缓存中加载资源，不会建立 TCP 链接，network 的会有不同的表现：

form disk, 表示缓存来自硬盘，一些较大的文件会被缓存到硬盘中，因为硬盘便宜且空间大

form memory, 表示缓存来自内存，

> css、js 等静态资源文件的强缓存怎么设置?
>
> 1. nginx 配置
> 2. `<meta http-equiv="Cache-Control" content="max-age=7200" />`

## 2. URL 的解析

当你在浏览器输入 URL 并按下 Enter, 浏览器会首先检查输入内容是否有域名，

如果有域名，则会先查找本地 DNS 缓存中是否有该域名，如果没有，则会向配置的 DNS 服务器发送请求，解析域名对应的 IP 地址

## 3. 建立连接

**TCP 连接**
三次握手

1. 客户端发送一个带 syn 标志的包到服务器
2. 服务器响应一个带 SYN-ACK 标志的包
3. 客户端响应一个带 ACK 标志的包，此时连接建立

**TLS 连接（HTTPS 连接）**
包括证书验证、密钥交换等步骤，确保建立一个安全的加密连接

## 4. 发送 HTTP 请求

## 5. 服务器处理请求

根据请求的类型，查询数据库、运行后端代码、或者直接返回静态资源

**协商缓存判断**

两个字段判断
If-Modify-since: 资源最后的修改时间,
If-None-match: 资源的 Etag,

如果资源未修改，服务器返回 304（Not Modified）状态码，浏览器继续使用缓存

## 6. 服务器响应请求

向浏览器发送一个请求，包括响应头、响应体、状态码

## 7. 浏览器处理响应

解析 HTML: 构建 DOM 树
发送额外的请求: HTML 包含的其他资源请求
构建 CSSOM:
渲染树构建: 将 DOM 树和 CSSOM 树合并为渲染树
布局（layout）:计算渲染树中每个节点的位置和大小
绘制(Painting):根据渲染树和布局信息，将内容绘制到屏幕上

## 8. javascript 执行

如果页面包含 js, 浏览器还会解析和执行 js, 这可能会修改 DOM 和触发重新渲染
