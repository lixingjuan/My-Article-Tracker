# 异步编程

同步行为和异步行为的对立统一是计算机科学的一个重要概念，特别是在js这种单线程语言中，同步操作和异步操作更是代码所要依赖的核心机制。异步操作是为了优化因计算量大而等待时间长的操作。如果在等待其他操作完成的同时，即使运行其他指令，也能保证系统的稳定，这么做就是务实的。
在实际的开发中，异步操作并不一定要计算量大或者耗时长。只要你不想为等位某个异步操作而阻塞线程的执行，任何时候都可以使用。



## 同步与异步

同步代码的执行原理

eg, `let x = 4; x = x + 3;`

这两行js代码对应的低级指令：
1. 首先操作系统会在栈内存上分配一个存储浮点数值的空间；
2. 然后针对这个值做一次数学计算；
3. 把计算结果写回之前分配的内存空间;


异步函数的执行步骤

```js
function double(value){
  setTimeout(()=> setTimeout(console.log, 0, value * 2), 1000)
};

double(3)
// 6 (大约1000毫秒之后)
```

> setTimeout 会定义一个在指定时间之后，被调度执行的回调函数;

对该例子而言，
1. 1000毫秒之后，js运行时会把回调函数推到自己的消息队列上去等待执行;
2. 推到消息队列之后，回调函数什么时候出列被执行，对 javascript 代码就完全不可见了;
3. 另外，double函数会在setTimeout 成功调度异步操作之后，立即退出;


