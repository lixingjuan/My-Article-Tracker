
# 强缓存

## 介绍

当浏览器发起请求时，如果上一次请求的`response-header`有`cache-control`和`expires`字段，则会做强缓存校验。


## 强缓存控制字段

强缓存校验由以下两组字段控制：

`cache-control` 字段: http1.1出现的字段，优先级更高，常用的字段值有：
  1. `public`,  所有用户可以缓存
  2. `private`, 仅客户端可缓存
  3. `no-cache`, 不使用强缓存， 使用协商缓存；不希望在没有经过服务器校验的前提下重用缓存，但是并不会阻止内容缓存；
  4. `no-store`, 强缓存和协商缓存均不使用；不希望内容缓存在任何位置，会阻止任何缓存，但是不会删除已经存储的内容；
  5. `max-age`, 本地缓存的有效时间, (单位：秒)

`expires`: 具体时间点，http1.0出现的字段



强缓存校验过程：取cache-control的 max-age 和 age 字段做比较，单位都是秒，判断缓存响应是否fresh, 若fresh, 则不会发起请求；


## 存储位置

1. form-disk,  大文件
2. form-memory-cache，小文件







# 协商缓存

## 控制字段

1. `Etag` 和 `if-none-match`: 表示文件本身的tag, 通常是根据文件内容生成的hash值，优先级较高；
2. `Last-Modified` 和 `If-Modified-Since`: 资源修改的日期和时间点；


## 协商缓存校验：

1. 未过期，服务器响应`304 Not Modified`；
2. 过期，响应`200 Ok`，并返回最新的内容；











## 强制使用协商缓存校验

通过在响应中添加 `Cache-Control: no-cache 以及 Last-Modified 和 ETag`；
或
在头中增加： `Cache-Control: max-age=0, must-revalidate`

具有相同效果
但是组合2是为了解决http1.0的问题，但是现在符合 HTTP/1.1 的服务器已经广泛部署，没有理由使用 max-age=0 和 must-revalidate 组合——你应该只使用 no-cache。


no-cache 指令不会阻止响应的存储，而是阻止在没有重新验证的情况下重用响应。



## css、js等静态资源文件的强缓存怎么设置

1. nginx配置
2. <meta http-equiv="Cache-Control" content="max-age=7200" />