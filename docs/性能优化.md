# 性能优化

> 请听题: 在整个开发全流程中，你认为可以做性能优化的地方？


🧠 loading......

其实性能优化是贯穿我们开发的全流程: 代码编写, 脚手架打包, 网络



## 公共的优化点
1. 路由lazy load 懒加载;
2. 大数据量的渲染采用虚拟列表(原理就是通过计算滚动高度，仅渲染窗口展示+往下一点点的dom，不过在我的项目经历中产品经理还是更倾向于分页的方式)
3. 减少重流重绘(重流，一般是布局整体改变，具体案例像图片，一定要给定初始宽高，不要等他加载出来又把布局往下挤; 重绘：颜色，透明度等);
4. dom不要嵌套过深，避免无用的层级;


## react

react中性能优化主要侧重于: 避免不必要的组建更新;

1. 利用 useCallback 和 useMemo 保持稳定的引用地址;
2. PureComponent, React.memo, 在prop引用地址改变时重新渲染, 跳过不必要的组件更新;
3. shouldComponent 等, 主动控制组件是否渲染;





## vue

我认为vue最大的特定就是响应式，而这也是vue中最消耗性能的地方，因为vue2.x需要深度递归到对象的每一个属性为其重新设置set/get， 方便后面的依赖收集和派发更新(ES6的proxy 已经解决这个问题, 这也是vue3.0比vue2.x快的原因)

1. 那vue的性能优化也可以从此处入手，避免响应所有的数据，不必要的变量不需要挂载data；
2. vue的更新机制是以组件为单位进行diff, 所以在开发组件的时候，组件尽量小/职责单一
3. 函数式组件`<template functional></template>`, 因为函数式组件，没有自己的状态，也没有实例，只接收数据做渲染，就是个纯粹的render, 所以性能消耗可忽略不计;



## webpack

webpack打包一个是排除一部分，缩短打包时间；
另一个是压缩代码，删除主食，缩小打包体积;

另外就是利用webpack 提供的功能，在路由的地方，添加一个魔法注释进行页面级别拆包;

1. dll，优化打包速度和体积
2. externals，思想和效果同dll, 部分较大的库使用cdn地址，缩短打包时间;
3. tread-loader, 开启多线程打包(webpack 5好像已经自动支持了)




## 网络层面

我认为网络层的优化主要是希望可以更快的获取资源，有了这个思路=>

1. 静态资源(图片, 或者以前三方库), 采用CDN可以提升拿到的速度;
2. 开启gzip对资源进行压缩, 这样资源小了，自然获取也更快;
3. 合并一些小请求;




## 浏览器的渲染

1. 利用prefetch/preload, 对资源进行预加载;
2. 减少重流重绘;
3. 减少空的img请求;
