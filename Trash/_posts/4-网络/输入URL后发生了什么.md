
![](x-mind/输入URL发生了什么.png)

# 输入URL后发生了什么?

从耗时上看，经历了

DNS解析 => TCP连接 => HTTP请求与响应 => 客户端浏览器解析渲染 => 连接结束
- DNS解析，
- TCP连接，
- HTTP请求与响应，
- 客户端浏览器解析渲染，
- 连接结束



1. 浏览器查找当前URL是否存在缓存，并比较缓存是否过期;
2. DNS解析URL对应的IP;
3. 根据IP建立TCP连接（三次握手）;
4. HTTP发起请求;
5. 服务器处理请求，浏览器接收http响应;
6. 渲染页面，构建DOM树;
7. 关闭TCP连接（四次挥手）;





# 2.DNS解析

把域名解析为IP地址的过程


# 3.TCP连接 - 俗称的三次握手





# HTTP请求与响应

HTTP请求，主要发生在客户端，发送HTTP请求的过程就是构建HTTP请求报文，并通过TCP协议发送到服务器指定端口的过程
- 当在地址栏输了地址后，浏览器就开始解析这个地址并设置请求报文，请求报文包括
   - 请求行（包含请求的路径、方法和协议版本），
   - 请求头（包含请求的一些附加信息，一般是以键值对的形式存在），
   - 空行（协议中规定请求头和请求主体之间必须用一个空行隔开），
   - 请求体（对于post请求，参数都不会拼在url上，这时候就需要一个载体，这个载体就是请求主体）
- 当服务器收到这个请求后，会根据url匹配到的路径做相应的处理，返回浏览器请求的页面资源
- 处理之后，浏览器会收到一个响应报文，与请求报文对应的，响应报文包含
   - 起始行（响应报文的起始行同样包含了协议版本，与请求行不同的是还包含了响应状态码和状态码的原因短语），
   - 响应头（对应请求报文中的请求头，格式一致，但是各自有各自不同的首部），
   - 空行；
   - 响应主体（请求需要的资源），不同的地方在于包含的内容不同




# 客户端浏览器解析渲染


包括HTML词法、语法的解析，CSS解析，DOM树生成，渲染树建立，屏幕绘制：
- 重绘，页面的一部分重新绘制，不影响整体布局，比如某个CSS的背景色变了，但元素的几何尺寸和位置不变
- 重排，意味着元件的几何尺寸变了，需要重新验证并计算渲染树，是渲染树的一部分或者全部发生了变化
- 无论是重绘，重排，都是浏览器性能的一种消耗，应该尽量避免这种情况









# 四次挥手

由于TCP连接是==全双工==的，因此每个方向都必须单独进行关闭。
原则是当一方完成它的数据发送任务后就能发送一个FIN来终止这个方向的连接。收到一个 FIN只意味着这一方向上没有数据流动，一个TCP连接在收到一个FIN后仍能发送数据。首先进行关闭的一方将执行主动关闭，而另一方执行被动关闭。

（1） TCP客户端发送一个FIN，用来关闭客户到服务器的数据传送。
（2） 服务器收到这个FIN，它发回一个ACK，确认序号为收到的序号加1。
（3） 服务器关闭客户端的连接，发送一个FIN给客户端。
（4） 客户端发回ACK报文确认，并将确认序号设置为收到序号加1



## 计算机网络

### 网络的传输

![](images/输入URL后发生了什么-21-06-23-05-59-51.png)

### TCP/IP协议族，各层的作用

![](images/输入URL后发生了什么-21-06-23-06-01-41.png)

### TCP协议

![](images/输入URL后发生了什么-21-06-26-06-09-12.png)


### 应用层 - DNS解析

![](images/输入URL后发生了什么-21-06-26-06-37-03.png)

### 各种协议和HTTP协议的关系

![](images/输入URL后发生了什么-21-06-26-06-51-27.png)





# 通用头部字段
## cache-control

1. no-cache 指令

如果客户端的请求中包含该字段，则表示客户端不会再接收缓存过的响应，于是，“中间” 缓存服务器必须把客户端请求转发给源服务器进行有效性认证。
[在发布缓存副本之前，强制要求缓存把请求提交给原始服务器进行验证(协商缓存验证)。]

如果服务器返回的请求包含该字段，缓存服务器不能对资源进行缓存。源服务器以后也将不再对缓存服务器请求中提出的资源有效性进行确认，且禁止其对响应资源进行缓存操作。

2. no-store 指令


缓存不应存储有关客户端请求或服务器响应的任何内容，即不使用任何缓存


## ETags

作为缓存的一种强校验器，ETag 响应头是一个对用户代理(User Agent, 下面简称UA)不透明（译者注：UA 无需理解，只需要按规定使用即可）的值。对于像浏览器这样的HTTP UA，不知道ETag代表什么，不能预测它的值是多少。如果资源请求的响应头里含有ETag, 客户端可以在后续的请求的头中带上 If-None-Match 头来验证缓存。

Last-Modified 响应头可以作为一种弱校验器。说它弱是因为它只能精确到一秒。如果响应头里含有这个信息，客户端可以在后续的请求中带上 If-Modified-Since 来验证缓存。

## 需要重新验证

指定 no-cache 或者 max-age=0, 表示客户端可以对资源进行缓存，但是每次使用缓存资源之前都必须重新验证其有效性。这意味着每次都会发起HTTP请求，但当缓存资源仍有效时可以跳过 HTTP 响应体的下载
